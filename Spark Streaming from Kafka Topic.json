{"paragraphs":[{"text":"%dep\n\n// Load all the dependencies\n// This will let us connect Spark Streaming to Kafka topics\n\nz.load(\"spark-streaming-kafka-0-10_2.11-2.2.1.jar\")\nz.load(\"spark-sql-kafka-0-10_2.11-2.1.1.jar\")\nz.load(\"kafka-clients-0.11.0.1.jar\")\n","user":"anonymous","dateUpdated":"2023-03-12T04:08:29-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res0: org.apache.zeppelin.dep.Dependency = org.apache.zeppelin.dep.Dependency@525f997\n"}]},"apps":[],"jobName":"paragraph_1678618661806_-526523737","id":"20220723-102333_1629025118","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2255"},{"text":"sc.version","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res1: String = 2.2.1\n"}]},"apps":[],"jobName":"paragraph_1678618661814_1603235126","id":"20220723-102346_1381847078","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2256"},{"text":"import org.apache.spark.streaming._\r\nimport org.apache.spark.sql.types._","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.streaming._\nimport org.apache.spark.sql.types._\n"}]},"apps":[],"jobName":"paragraph_1678618661822_-843741703","id":"20220723-102419_1407180538","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2257"},{"text":"/*\r\n    6371.0 is the mean radius of the Earth in km\r\n    3958.761 is the mean radius of the Earth in miles\r\n*/\r\n\r\ndef haversineDistance(pointA: (Double, Double), pointB: (Double, Double)): Double = {\r\n  val deltaLat = math.toRadians(pointB._1 - pointA._1)\r\n  val deltaLong = math.toRadians(pointB._2 - pointA._2)\r\n  val a = math.pow(math.sin(deltaLat / 2), 2) + math.cos(math.toRadians(pointA._1)) * math.cos(math.toRadians(pointB._1)) * math.pow(math.sin(deltaLong / 2), 2)\r\n  val greatCircleDistance = 2 * math.atan2(math.sqrt(a), math.sqrt(1 - a))\r\n  6371.0 * greatCircleDistance\r\n}","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"haversineDistance: (pointA: (Double, Double), pointB: (Double, Double))Double\n"}]},"apps":[],"jobName":"paragraph_1678618661830_1964004761","id":"20220723-122327_148384490","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2258"},{"text":"val kafkaStream = spark\n  .readStream\n  .format(\"kafka\")\n  .option(\"kafka.bootstrap.servers\", \"localhost:9092\")\n  .option(\"subscribe\", \"live_flights\")\n  .option(\"startingOffsets\",\"latest\")\n  .load()","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"kafkaStream: org.apache.spark.sql.DataFrame = [key: binary, value: binary ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1678618661833_348772064","id":"20220723-102439_952393278","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2259"},{"text":"kafkaStream.printSchema","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- key: binary (nullable = true)\n |-- value: binary (nullable = true)\n |-- topic: string (nullable = true)\n |-- partition: integer (nullable = true)\n |-- offset: long (nullable = true)\n |-- timestamp: timestamp (nullable = true)\n |-- timestampType: integer (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1678618661836_-1415231377","id":"20220723-102512_2071557077","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2260"},{"text":"val pointMontreal = (45.4690, -73.7378)","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"pointMontreal: (Double, Double) = (45.469,-73.7378)\n"}]},"apps":[],"jobName":"paragraph_1678618661840_1460504315","id":"20220725-104104_1344659259","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2261"},{"text":"val dataStream = kafkaStream.selectExpr(\"CAST(value AS STRING)\").as[String]","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"dataStream: org.apache.spark.sql.Dataset[String] = [value: string]\n"}]},"apps":[],"jobName":"paragraph_1678618661842_-353557842","id":"20220723-102638_2053503786","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2262"},{"text":"case class DistSchema(\n    ac_number: String,  \n    ac_distance_km: Double)","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"defined class DistSchema\n"}]},"apps":[],"jobName":"paragraph_1678618661845_-1934724483","id":"20220725-105144_2974964","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2263"},{"text":"val distance = dataStream.map(row => row.split(\"[:,}]\")).map(row => (row(2), haversineDistance((row(11).toDouble, row(13).toDouble), pointMontreal)))\n\t\t\t.map(row => DistSchema(row._1,row._2))","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"distance: org.apache.spark.sql.Dataset[DistSchema] = [ac_number: string, ac_distance_km: double]\n"}]},"apps":[],"jobName":"paragraph_1678618661848_593689543","id":"20220725-104744_1549113387","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2264"},{"text":"distance.printSchema","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- ac_number: string (nullable = true)\n |-- ac_distance_km: double (nullable = false)\n\n"}]},"apps":[],"jobName":"paragraph_1678618661850_1483435677","id":"20220725-114926_29091036","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2265"},{"text":"distance\r\n      .writeStream\r\n      .format(\"console\")\r\n      .outputMode(\"append\")\r\n      .start()\r\n      .awaitTermination()","user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1678618661853_-1831399182","id":"20220724-110732_37763955","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2266"},{"user":"anonymous","dateUpdated":"2023-03-12T04:08:30-0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1678618661857_-1458998789","id":"20220725-104806_122966792","dateCreated":"2023-03-12T03:57:41-0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2267"}],"name":"Spark Streaming from Kafka Topic","id":"2HV4EBRBB","noteParams":{},"noteForms":{},"angularObjects":{"sh:shared_process":[],"spark:shared_process":[],"hive:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}